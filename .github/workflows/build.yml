name: Web to APK Builder

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Set up Android SDK
        uses: android-actions/setup-android@v3

      - name: Create Basic Android Project
        run: |
          # Dışarıdan clone yapmak yerine en basit WebView projesini kuruyoruz
          # Bu yöntem 128 hatasını kesin çözer.
          mkdir -p app/src/main/assets
          mkdir -p app/src/main/java/com/example/ramazan
          mkdir -p app/src/main/res/layout
          
          # Web dosyalarını assets klasörüne taşı
          cp index.html app/src/main/assets/ || true
          cp style.css app/src/main/assets/ || true
          cp script.js app/src/main/assets/ || true

          # Gerekli Android build dosyalarını oluştur
          echo 'apply plugin: "com.android.application"
          android {
              namespace "com.example.ramazan"
              compileSdk 34
              defaultConfig {
                  applicationId "com.example.ramazan"
                  minSdk 21
                  targetSdk 34
                  versionCode 1
                  versionName "1.0"
              }
          }
          repositories { google(); mavenCentral() }' > build.gradle

          echo 'include ":app"' > settings.gradle

      - name: Build with Gradle
        # Hızlıca boş bir proje üzerinden APK üretimi
        run: |
          # Bu adımda basit bir wrapper kullanacağız veya 
          # GitHub Actions üzerindeki yüklü gradle'ı tetikleyeceğiz
          gradle assembleDebug

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: ramazan-asistani-apk
          path: app/build/outputs/apk/debug/*.apk
          
